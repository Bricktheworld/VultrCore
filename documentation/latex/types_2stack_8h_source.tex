\hypertarget{types_2stack_8h_source}{}\doxysection{stack.\+h}
\label{types_2stack_8h_source}\index{src/types/stack.h@{src/types/stack.h}}
\mbox{\hyperlink{types_2stack_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// TODO(Brandon): Replace with custom allocator.}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{3 \textcolor{preprocessor}{\#include <assert.h>}}
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include <memory>}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{thread_8h}{thread.h}}"{}}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{types_8h}{types/types.h}}"{}}}
\DoxyCodeLine{7 }
\DoxyCodeLine{8 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacevtl}{vtl}}}
\DoxyCodeLine{9 \{}
\DoxyCodeLine{10     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T, \textcolor{keywordtype}{size\_t} reserved = 10, u32 growth\_numerator = 3, u32 growth\_denominator = 2, u32 decay\_percent\_threshold = 30, \textcolor{keywordtype}{bool} threaded = false>}
\DoxyCodeLine{11     \textcolor{keyword}{struct }\mbox{\hyperlink{structvtl_1_1Stack}{Stack}}}
\DoxyCodeLine{12     \{}
\DoxyCodeLine{13         \mbox{\hyperlink{structvtl_1_1Stack_a350bb71ab61946989f97413226db61ee}{Stack}}()}
\DoxyCodeLine{14         \{}
\DoxyCodeLine{15             \mbox{\hyperlink{structvtl_1_1Stack_a62aa9df454802bfaff31ecef59514e77}{\_size}} = reserved;}
\DoxyCodeLine{16             \mbox{\hyperlink{structvtl_1_1Stack_a7d7e48804166374cf12deceb3ec7e109}{len}}   = 0;}
\DoxyCodeLine{17             \textcolor{keywordflow}{if} (reserved > 0)}
\DoxyCodeLine{18             \{}
\DoxyCodeLine{19                 \textcolor{comment}{// \_array = static\_cast<T *>(malloc(\_size * sizeof(T)));}}
\DoxyCodeLine{20             \}}
\DoxyCodeLine{21         \}}
\DoxyCodeLine{22 }
\DoxyCodeLine{23         \mbox{\hyperlink{structvtl_1_1Stack_a81ecd6cb412dfba00491dba2550ad1c8}{Stack}}(T *array, \textcolor{keywordtype}{size\_t} count)}
\DoxyCodeLine{24         \{}
\DoxyCodeLine{25             assert(count != 0 \&\& \textcolor{stringliteral}{"{}Count must be greater than 0!"{}});}
\DoxyCodeLine{26             assert(array != \textcolor{keyword}{nullptr} \&\& \textcolor{stringliteral}{"{}Array must not be null!"{}});}
\DoxyCodeLine{27 }
\DoxyCodeLine{28             \mbox{\hyperlink{structvtl_1_1Stack_a7d7e48804166374cf12deceb3ec7e109}{len}}   = count;}
\DoxyCodeLine{29             \mbox{\hyperlink{structvtl_1_1Stack_a62aa9df454802bfaff31ecef59514e77}{\_size}} = \mbox{\hyperlink{structvtl_1_1Stack_a7d7e48804166374cf12deceb3ec7e109}{len}} * \mbox{\hyperlink{structvtl_1_1Stack_a50e973d7296a9ed89032e7108dd52e3e}{growth\_factor}};}
\DoxyCodeLine{30             \textcolor{keywordflow}{if} (\mbox{\hyperlink{structvtl_1_1Stack_a62aa9df454802bfaff31ecef59514e77}{\_size}} < reserved)}
\DoxyCodeLine{31             \{}
\DoxyCodeLine{32                 \mbox{\hyperlink{structvtl_1_1Stack_a62aa9df454802bfaff31ecef59514e77}{\_size}} = reserved;}
\DoxyCodeLine{33             \}}
\DoxyCodeLine{34 }
\DoxyCodeLine{35             \textcolor{comment}{// \_array = static\_cast<T *>(malloc(sizeof(T) * \_size));}}
\DoxyCodeLine{36 }
\DoxyCodeLine{37             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < count; i++)}
\DoxyCodeLine{38             \{}
\DoxyCodeLine{39                 \mbox{\hyperlink{structvtl_1_1Stack_aee219131a3fdb5f8d0dfd1411c6a1bbe}{\_array}}[i] = array[i];}
\DoxyCodeLine{40             \}}
\DoxyCodeLine{41         \}}
\DoxyCodeLine{42 }
\DoxyCodeLine{43         \textcolor{comment}{// Delete copy methods because we don't want this to be done on accident, we want it to be very very explicit since we are essentially duplicating a buffer}}
\DoxyCodeLine{44         \mbox{\hyperlink{structvtl_1_1Stack}{Stack<T>}} \&\mbox{\hyperlink{structvtl_1_1Stack_a5f3ac32d50ae19b348379c644a05ea1a}{operator=}}(\textcolor{keyword}{const} \mbox{\hyperlink{structvtl_1_1Stack}{Stack<T>}} \&other) = \textcolor{keyword}{delete};}
\DoxyCodeLine{45         \mbox{\hyperlink{structvtl_1_1Stack_a0a92db6d3d72ad0109d132d88bb07815}{Stack}}(\textcolor{keyword}{const} \mbox{\hyperlink{structvtl_1_1Stack}{Stack<T>}} \&other)               = \textcolor{keyword}{delete};}
\DoxyCodeLine{46 }
\DoxyCodeLine{47         \textcolor{comment}{// Destructor for dynamic array}}
\DoxyCodeLine{48         \mbox{\hyperlink{structvtl_1_1Stack_a9858ac55c5501dc678444312a04c9835}{\string~Stack}}()}
\DoxyCodeLine{49         \{}
\DoxyCodeLine{50             \textcolor{comment}{// if (\_array != nullptr)}}
\DoxyCodeLine{51             \textcolor{comment}{//     free(\_array);}}
\DoxyCodeLine{52         \}}
\DoxyCodeLine{53 }
\DoxyCodeLine{54         \textcolor{comment}{// Push element to back of Stack}}
\DoxyCodeLine{55         \textcolor{comment}{// If the Stack does not have enough space, then a reallocation will}}
\DoxyCodeLine{56         \textcolor{comment}{// occur}}
\DoxyCodeLine{57         \textcolor{comment}{//}}
\DoxyCodeLine{58         \textcolor{comment}{// Returns the element just inserted}}
\DoxyCodeLine{59         T *\mbox{\hyperlink{structvtl_1_1Stack_ad0db021cf419b973079173ee6abbf817}{push}}(\textcolor{keyword}{const} T \&element)}
\DoxyCodeLine{60         \{}
\DoxyCodeLine{61             \textcolor{keywordflow}{if} (threaded)}
\DoxyCodeLine{62                 \mbox{\hyperlink{structvtl_1_1Stack_af5c71aef64a7d134981ee1ef3510c86d}{stack\_mutex}}.lock();}
\DoxyCodeLine{63             \mbox{\hyperlink{structvtl_1_1Stack_a7d7e48804166374cf12deceb3ec7e109}{len}}++;}
\DoxyCodeLine{64             \mbox{\hyperlink{structvtl_1_1Stack_ad912aaa2f606a1e120193177f98a9d42}{\_reallocate}}();}
\DoxyCodeLine{65 }
\DoxyCodeLine{66             \textcolor{comment}{// Increase the len amount and assign the last element of array to the new}}
\DoxyCodeLine{67             \textcolor{comment}{// element}}
\DoxyCodeLine{68             \mbox{\hyperlink{structvtl_1_1Stack_aee219131a3fdb5f8d0dfd1411c6a1bbe}{\_array}}[\mbox{\hyperlink{structvtl_1_1Stack_a7d7e48804166374cf12deceb3ec7e109}{len}} -\/ 1] = element;}
\DoxyCodeLine{69 }
\DoxyCodeLine{70             \textcolor{keywordflow}{if} (threaded)}
\DoxyCodeLine{71             \{}
\DoxyCodeLine{72                 \mbox{\hyperlink{structvtl_1_1Stack_af5c71aef64a7d134981ee1ef3510c86d}{stack\_mutex}}.unlock();}
\DoxyCodeLine{73                 \mbox{\hyperlink{structvtl_1_1Stack_a94b8824c8141aecacc6981cbb336b616}{stack\_cond}}.notify\_one();}
\DoxyCodeLine{74             \}}
\DoxyCodeLine{75 }
\DoxyCodeLine{76             \textcolor{keywordflow}{return} \&\mbox{\hyperlink{structvtl_1_1Stack_aee219131a3fdb5f8d0dfd1411c6a1bbe}{\_array}}[\mbox{\hyperlink{structvtl_1_1Stack_a7d7e48804166374cf12deceb3ec7e109}{len}} -\/ 1];}
\DoxyCodeLine{77         \}}
\DoxyCodeLine{78 }
\DoxyCodeLine{79         T *\mbox{\hyperlink{structvtl_1_1Stack_aa1c03038051a058ff9772ffdb68b92f1}{top}}()}
\DoxyCodeLine{80         \{}
\DoxyCodeLine{81             \textcolor{keywordflow}{if} (threaded)}
\DoxyCodeLine{82                 \mbox{\hyperlink{structvtl_1_1Stack_af5c71aef64a7d134981ee1ef3510c86d}{stack\_mutex}}.lock();}
\DoxyCodeLine{83             assert(\mbox{\hyperlink{structvtl_1_1Stack_a7d7e48804166374cf12deceb3ec7e109}{len}} > 0 \&\& \textcolor{stringliteral}{"{}No \_array in queue!"{}});}
\DoxyCodeLine{84             T *item = \&\mbox{\hyperlink{structvtl_1_1Stack_aee219131a3fdb5f8d0dfd1411c6a1bbe}{\_array}}[\mbox{\hyperlink{structvtl_1_1Stack_a7d7e48804166374cf12deceb3ec7e109}{len}} -\/ 1];}
\DoxyCodeLine{85             \textcolor{keywordflow}{if} (threaded)}
\DoxyCodeLine{86                 \mbox{\hyperlink{structvtl_1_1Stack_af5c71aef64a7d134981ee1ef3510c86d}{stack\_mutex}}.unlock();}
\DoxyCodeLine{87             \textcolor{keywordflow}{return} item;}
\DoxyCodeLine{88         \}}
\DoxyCodeLine{89 }
\DoxyCodeLine{90         \textcolor{comment}{// Pop last element of stack}}
\DoxyCodeLine{91         \textcolor{keywordtype}{void} \mbox{\hyperlink{structvtl_1_1Stack_ae4d5b5976956adf547ce1416c573d228}{pop}}()}
\DoxyCodeLine{92         \{}
\DoxyCodeLine{93             \textcolor{keywordflow}{if} (threaded)}
\DoxyCodeLine{94                 std::unique\_lock<vtl::mutex> lock(\mbox{\hyperlink{structvtl_1_1Stack_af5c71aef64a7d134981ee1ef3510c86d}{stack\_mutex}});}
\DoxyCodeLine{95             \textcolor{keywordtype}{size\_t} index = \mbox{\hyperlink{structvtl_1_1Stack_a7d7e48804166374cf12deceb3ec7e109}{len}} -\/ 1;}
\DoxyCodeLine{96 }
\DoxyCodeLine{97             \textcolor{comment}{// Fail if the index is greater than the len or negative}}
\DoxyCodeLine{98             assert(index <= len \&\& index >= 0 \&\& \textcolor{stringliteral}{"{}Index out of bounds!"{}});}
\DoxyCodeLine{99 }
\DoxyCodeLine{100             \textcolor{comment}{// Shift elements to the left}}
\DoxyCodeLine{101             \textcolor{keywordflow}{for} (\mbox{\hyperlink{types_8h_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint}} i = index + 1; i < \mbox{\hyperlink{structvtl_1_1Stack_a62aa9df454802bfaff31ecef59514e77}{\_size}}; i++)}
\DoxyCodeLine{102             \{}
\DoxyCodeLine{103                 \mbox{\hyperlink{structvtl_1_1Stack_aee219131a3fdb5f8d0dfd1411c6a1bbe}{\_array}}[i -\/ 1] = \mbox{\hyperlink{structvtl_1_1Stack_aee219131a3fdb5f8d0dfd1411c6a1bbe}{\_array}}[i];}
\DoxyCodeLine{104             \}}
\DoxyCodeLine{105 }
\DoxyCodeLine{106             \textcolor{comment}{// Decrease len even if no reallocation}}
\DoxyCodeLine{107             \mbox{\hyperlink{structvtl_1_1Stack_a7d7e48804166374cf12deceb3ec7e109}{len}}-\/-\/;}
\DoxyCodeLine{108 }
\DoxyCodeLine{109             \mbox{\hyperlink{structvtl_1_1Stack_ad912aaa2f606a1e120193177f98a9d42}{\_reallocate}}();}
\DoxyCodeLine{110         \}}
\DoxyCodeLine{111 }
\DoxyCodeLine{112         \textcolor{keywordtype}{void} \mbox{\hyperlink{structvtl_1_1Stack_a451b63f1a83f99fc4bd01cfbe5bffc4a}{pop\_wait}}()}
\DoxyCodeLine{113         \{}
\DoxyCodeLine{114             assert(threaded \&\& \textcolor{stringliteral}{"{}Stack must be threaded before you can pop wait!"{}});}
\DoxyCodeLine{115             std::unique\_lock<vtl::mutex> lock(\mbox{\hyperlink{structvtl_1_1Stack_af5c71aef64a7d134981ee1ef3510c86d}{stack\_mutex}});}
\DoxyCodeLine{116             \textcolor{keywordflow}{while} (\mbox{\hyperlink{structvtl_1_1Stack_ac34fe068a1a9396b4f8b6394f08cac64}{empty}}())}
\DoxyCodeLine{117             \{}
\DoxyCodeLine{118                 \mbox{\hyperlink{structvtl_1_1Stack_a94b8824c8141aecacc6981cbb336b616}{stack\_cond}}.wait(lock);}
\DoxyCodeLine{119             \}}
\DoxyCodeLine{120             \mbox{\hyperlink{structvtl_1_1Stack_ae4d5b5976956adf547ce1416c573d228}{pop}}();}
\DoxyCodeLine{121         \}}
\DoxyCodeLine{122 }
\DoxyCodeLine{123         \textcolor{keywordtype}{bool} \mbox{\hyperlink{structvtl_1_1Stack_ac34fe068a1a9396b4f8b6394f08cac64}{empty}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \mbox{\hyperlink{structvtl_1_1Stack_a7d7e48804166374cf12deceb3ec7e109}{len}} == 0; \}}
\DoxyCodeLine{124 }
\DoxyCodeLine{125         \textcolor{keywordtype}{void} \mbox{\hyperlink{structvtl_1_1Stack_aaeca059026fddc2726c021c7740e692b}{clear}}()}
\DoxyCodeLine{126         \{}
\DoxyCodeLine{127             \mbox{\hyperlink{structvtl_1_1Stack_a7d7e48804166374cf12deceb3ec7e109}{len}}   = 0;}
\DoxyCodeLine{128             \mbox{\hyperlink{structvtl_1_1Stack_a62aa9df454802bfaff31ecef59514e77}{\_size}} = reserved;}
\DoxyCodeLine{129             \textcolor{keywordflow}{if} (reserved > 0)}
\DoxyCodeLine{130             \{}
\DoxyCodeLine{131                 \textcolor{keywordflow}{if} (\mbox{\hyperlink{structvtl_1_1Stack_aee219131a3fdb5f8d0dfd1411c6a1bbe}{\_array}} == \textcolor{keyword}{nullptr})}
\DoxyCodeLine{132                 \{}
\DoxyCodeLine{133                     \textcolor{comment}{// \_array = (T *)malloc(\_size * sizeof(T));}}
\DoxyCodeLine{134                 \}}
\DoxyCodeLine{135                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{136                 \{}
\DoxyCodeLine{137                     \textcolor{comment}{// \_array = (T *)realloc(\_array, \_size * sizeof(T));}}
\DoxyCodeLine{138                 \}}
\DoxyCodeLine{139             \}}
\DoxyCodeLine{140         \}}
\DoxyCodeLine{141 }
\DoxyCodeLine{142         \textcolor{comment}{// Spaces len (not bytes)}}
\DoxyCodeLine{143         \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{structvtl_1_1Stack_a7d7e48804166374cf12deceb3ec7e109}{len}} = 0;}
\DoxyCodeLine{144 }
\DoxyCodeLine{145         \textcolor{comment}{// Space in \_array (not bytes)}}
\DoxyCodeLine{146         \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{structvtl_1_1Stack_a62aa9df454802bfaff31ecef59514e77}{\_size}} = reserved;}
\DoxyCodeLine{147 }
\DoxyCodeLine{148         \textcolor{comment}{// To make sure that the buffer expansion is geometric}}
\DoxyCodeLine{149         \mbox{\hyperlink{types_8h_a94dab5770726ccbef8c7d026cfbdf8e5}{f64}} \mbox{\hyperlink{structvtl_1_1Stack_a50e973d7296a9ed89032e7108dd52e3e}{growth\_factor}} = (\mbox{\hyperlink{types_8h_a94dab5770726ccbef8c7d026cfbdf8e5}{f64}})growth\_numerator / (\mbox{\hyperlink{types_8h_a94dab5770726ccbef8c7d026cfbdf8e5}{f64}})growth\_denominator;}
\DoxyCodeLine{150 }
\DoxyCodeLine{151         \textcolor{keywordtype}{void} \mbox{\hyperlink{structvtl_1_1Stack_ad912aaa2f606a1e120193177f98a9d42}{\_reallocate}}()}
\DoxyCodeLine{152         \{}
\DoxyCodeLine{153             \textcolor{comment}{// Only reallocate and expand the array if we need to}}
\DoxyCodeLine{154             \textcolor{keywordflow}{if} (\mbox{\hyperlink{structvtl_1_1Stack_a7d7e48804166374cf12deceb3ec7e109}{len}} > \mbox{\hyperlink{structvtl_1_1Stack_a62aa9df454802bfaff31ecef59514e77}{\_size}})}
\DoxyCodeLine{155             \{}
\DoxyCodeLine{156                 \mbox{\hyperlink{structvtl_1_1Stack_a62aa9df454802bfaff31ecef59514e77}{\_size}} = \mbox{\hyperlink{structvtl_1_1Stack_a7d7e48804166374cf12deceb3ec7e109}{len}} * \mbox{\hyperlink{structvtl_1_1Stack_a50e973d7296a9ed89032e7108dd52e3e}{growth\_factor}};}
\DoxyCodeLine{157             \}}
\DoxyCodeLine{158             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((\mbox{\hyperlink{types_8h_a94dab5770726ccbef8c7d026cfbdf8e5}{f64}})\mbox{\hyperlink{structvtl_1_1Stack_a7d7e48804166374cf12deceb3ec7e109}{len}} / (\mbox{\hyperlink{types_8h_a94dab5770726ccbef8c7d026cfbdf8e5}{f64}})\mbox{\hyperlink{structvtl_1_1Stack_a62aa9df454802bfaff31ecef59514e77}{\_size}} < (\mbox{\hyperlink{types_8h_a94dab5770726ccbef8c7d026cfbdf8e5}{f64}})decay\_percent\_threshold / 100.0)}
\DoxyCodeLine{159             \{}
\DoxyCodeLine{160                 \mbox{\hyperlink{structvtl_1_1Stack_a62aa9df454802bfaff31ecef59514e77}{\_size}} = \mbox{\hyperlink{structvtl_1_1Stack_a7d7e48804166374cf12deceb3ec7e109}{len}} * \mbox{\hyperlink{structvtl_1_1Stack_a50e973d7296a9ed89032e7108dd52e3e}{growth\_factor}};}
\DoxyCodeLine{161             \}}
\DoxyCodeLine{162             \textcolor{keywordflow}{else}}
\DoxyCodeLine{163             \{}
\DoxyCodeLine{164                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{165             \}}
\DoxyCodeLine{166 }
\DoxyCodeLine{167             \textcolor{keywordflow}{if} (\mbox{\hyperlink{structvtl_1_1Stack_a62aa9df454802bfaff31ecef59514e77}{\_size}} < reserved)}
\DoxyCodeLine{168             \{}
\DoxyCodeLine{169                 \mbox{\hyperlink{structvtl_1_1Stack_a62aa9df454802bfaff31ecef59514e77}{\_size}} = reserved;}
\DoxyCodeLine{170             \}}
\DoxyCodeLine{171 }
\DoxyCodeLine{172             \textcolor{keywordflow}{if} (\mbox{\hyperlink{structvtl_1_1Stack_a62aa9df454802bfaff31ecef59514e77}{\_size}} == 0)}
\DoxyCodeLine{173             \{}
\DoxyCodeLine{174                 \textcolor{keywordflow}{if} (\mbox{\hyperlink{structvtl_1_1Stack_aee219131a3fdb5f8d0dfd1411c6a1bbe}{\_array}} != \textcolor{keyword}{nullptr})}
\DoxyCodeLine{175                 \{}
\DoxyCodeLine{176                     \textcolor{comment}{// free(\_array);}}
\DoxyCodeLine{177                     \mbox{\hyperlink{structvtl_1_1Stack_aee219131a3fdb5f8d0dfd1411c6a1bbe}{\_array}} = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{178                 \}}
\DoxyCodeLine{179             \}}
\DoxyCodeLine{180             \textcolor{keywordflow}{else}}
\DoxyCodeLine{181             \{}
\DoxyCodeLine{182                 \textcolor{keywordflow}{if} (\mbox{\hyperlink{structvtl_1_1Stack_aee219131a3fdb5f8d0dfd1411c6a1bbe}{\_array}} == \textcolor{keyword}{nullptr})}
\DoxyCodeLine{183                 \{}
\DoxyCodeLine{184                     \textcolor{comment}{// \_array = (T *)malloc(\_size * sizeof(T));}}
\DoxyCodeLine{185                 \}}
\DoxyCodeLine{186                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{187                 \{}
\DoxyCodeLine{188                     \textcolor{comment}{// \_array = (T *)realloc(\_array, \_size * sizeof(T));}}
\DoxyCodeLine{189                 \}}
\DoxyCodeLine{190             \}}
\DoxyCodeLine{191         \}}
\DoxyCodeLine{192 }
\DoxyCodeLine{193         \textcolor{comment}{// The internal array}}
\DoxyCodeLine{194         T *\mbox{\hyperlink{structvtl_1_1Stack_aee219131a3fdb5f8d0dfd1411c6a1bbe}{\_array}};}
\DoxyCodeLine{195 }
\DoxyCodeLine{196         \mbox{\hyperlink{namespacevtl_adc91b7ec14024659cb575eeabc7f0d77}{vtl::mutex}} \mbox{\hyperlink{structvtl_1_1Stack_af5c71aef64a7d134981ee1ef3510c86d}{stack\_mutex}};}
\DoxyCodeLine{197         \mbox{\hyperlink{namespacevtl_a7d8495d7884ddb7182a5b2db93ab0915}{vtl::condition\_variable}} \mbox{\hyperlink{structvtl_1_1Stack_a94b8824c8141aecacc6981cbb336b616}{stack\_cond}};}
\DoxyCodeLine{198     \};}
\DoxyCodeLine{199 \} \textcolor{comment}{// namespace vtl}}

\end{DoxyCode}
